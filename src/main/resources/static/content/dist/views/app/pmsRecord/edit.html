<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/admin-static/layui/css/layui.css">
</head>
<body>
<div class="layui-field-box" style="margin-top: 10px;">
<form id="editForm" class="layui-form" action="" onsubmit="return false;">
	<input type="hidden" name="recordId" value="">
	<div class="layui-form-item">
		<label class="layui-form-label">论文计划</label>
		<div class="layui-input-block">
			<select id="planId" name="planId" lay-filter="planId">
			</select>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">指导教师</label>
		<div class="layui-input-block">
			<select id="teachId" name="teachId" lay-filter="teachId">
			</select>
		</div>
	</div>

	<div class="layui-form-item" style="display: none;">
		<label class="layui-form-label">计划类型</label>
		<div class="layui-input-block">
			<input type="text" name="planType" value=""
				   lay-verify="required" placeholder="请输入计划类型，1开题报告，2初稿提交，3终稿提交" autocomplete="off"
				   class="layui-input">
		</div>
	</div>
	<div class="layui-form-item" style="display: none;">
		<label class="layui-form-label">计划名称</label>
		<div class="layui-input-block">
			<input type="text" name="planName" value=""
				   lay-verify="required" placeholder="请输入计划名称" autocomplete="off"
				   class="layui-input">
		</div>
	</div>
	<div class="layui-form-item" style="display: none;">
		<label class="layui-form-label">教师工号</label>
		<div class="layui-input-block">
			<input type="text" name="teachUser" value=""
				   lay-verify="required" placeholder="请输入教师工号" autocomplete="off"
				   class="layui-input">
		</div>
	</div>
	<div class="layui-form-item" style="display: none;">
		<label class="layui-form-label">教师姓名</label>
		<div class="layui-input-block">
			<input type="text" name="teachNick" value=""
				   lay-verify="required" placeholder="请输入教师姓名" autocomplete="off"
				   class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">论文名称</label>
		<div class="layui-input-block">
			<input type="text" name="paperName" value=""
				   lay-verify="required" placeholder="请输入论文名称" autocomplete="off"
				   class="layui-input">
		</div>
	</div>
	<div class="page-footer" style="position: fixed;bottom: 0;margin-bottom: 45px;">
		<div class="btn-list">
			<div class="btnlist" style="position: fixed;right: 0;margin-right: 10px;">
				<button class="layui-btn" lay-submit lay-filter="updateObj"><i class="fa fa-floppy-o">&nbsp;</i>保存</button>
				<button class="layui-btn openWindow"><i class="fa fa-undo">&nbsp;</i>返回</button>
			</div>
		</div>
	</div>
</form>
</div>
</body>
<script type="text/javascript" src="/admin-static/javascript/jquery.min.js"></script>
<script type="text/javascript" src="/admin-static/layui/layui.js"></script>
<script type="text/javascript" src="/admin-static/javascript/common/common.js"></script>
<script type="text/javascript" src="/admin-static/javascript/common/common-list.js"></script>
<script type="text/javascript" src="/admin-static/javascript/pmsRecord/pmsRecord.js"></script>
<script type="text/javascript">
$(function(){
    $.ajax({
        type: "GET",
        url: findPlanByUser,
        success: function (resData) {
            if (resData.status === 200) {
                $("#planId").html("");
                $("#planId").append('<option value="" selected="">请选择</option>');
                var plans = resData.data;
                for (var i =0;i < plans.length;i++) {
                    var p = plans[i];
                    $("#planId").append('<option value="'+p.planId+'">'+p.planName+'</option>');
                }
            }
        }
    });
	//数据回显
	var editObjId = getUrlParam('editObjId');
    $.ajax({
        type:"GET",
        url:crudUrl+"/"+editObjId,
        success:function(resData) {
            if (resData.status === 200) {
                var findObj = resData.data;
                setFormData("editForm",findObj);
                var planId = findObj.planId;
                $.ajax({
                    type: "GET",
                    url: findPlanById+planId,
                    success: function (resData) {
                        if (resData.status === 200) {
                            var groupId = resData.data.userId;
                            if (groupId != null && groupId.length > 0) {
                                $("input[name='planType']").val(resData.data.planType);
                                $("input[name='planName']").val(resData.data.planName);
                                $.ajax({
                                    type: "GET",
                                    url: findUserByGroupUrl+groupId,
                                    success: function (resData) {
                                        if (resData.status === 200) {
                                            $("#teachId").html("");
                                            $("#teachId").append('<option value="" selected="">请选择指导教师</option>');
                                            var teachers = resData.data;
                                            for (var i =0;i < teachers.length;i++) {
                                                var p = teachers[i];
                                                $("#teachId").append('<option value="'+p.userId+'">'+p.nickname+' 【'+p.groupName+'】</option>');
                                            }
                                            layui.use(['form'], function () {
                                                var form = layui.form;
                                                console.log("重新渲染表单");
                                                setFormData("editForm",findObj);
                                                form.render();
                                            });
                                        }
                                    }
                                });
                            }
                        }
                    }
                });
            } else {
                layer.msg(resData.msg, {icon: 5});
            }
        }
    });
});
</script>
</html>